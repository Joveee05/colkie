# Colkie Rooms API

This API was built using :

- NestJS (NodeJS Framework)
- Mongoose (ODM that helps you to create a Schema based on the Model)
- Swagger(For API Documentation)
- Postman(For testing enpoints)
- MongoDB (NoSQL Database)
- Docker (Platform to deploy applications using containers)

GitHub Repository: https://github.com/Joveee05/colkie

---

Prerequisite: NodeJs & Postman installed, Docker (Docker desktop on windows/Mac Machines, Docker installed natively on Linux)

## NestJS

![image.png](https://cdn.hashnode.com/res/hashnode/image/upload/v1611143647173/upHLKKOgs.png)

NestJs is a Node.js framework for building efficient and scalable applications, with full support to Typescript. It has a CLI you can use to generate projects and block easily and It uses express under the hood but has many interesting features like the building blocks:

- Modules
- Providers
- Controllers
- Services

---

## Mongoose

![image.png](https://cdn.hashnode.com/res/hashnode/image/upload/v1611144288219/UhL2jsSdK.png)

Mongoose is an ODM (Object Data Modeling) javascript library for MongoDB and Node.

It is used to manage data relationships, uses Schemas and helps you to connect to a mongo db using mongo DRIVER

---

## MongoDB

![image.png](https://cdn.hashnode.com/res/hashnode/image/upload/v1611144597161/QGFJuh1z9.png)

MongoDB is a NoSQL database. It stores documents and by using a Json-like object structure it's very easy to use with a Node application

In this example, we will use MongoDB Atlas, which is a cloud solution and it's perfect for an example. But of course, we could use it locally, even better if inside a docker container.

---

## DOCKER

![image.png](https://cdn.hashnode.com/res/hashnode/image/upload/v1610521677853/SGKWuYsvU.png)

Docker is a platform to build run and share application using the idea of containers. If you want a brief introduction, here is a short video

---

### Project Setup

Install NestJS CLI

NestJS comes with an easy to use CLI, that you can install globally (or locally) and it helps you to get started and use NestJS

```
npm install -g @nestjs/cli
```

Install dependencies

```
npm install mongoose  @nestjs/mongoose
```

To check if it's running, just type

```
nest start
```

The app will be running on http://localhost:5000/api

Using the nest CLI, we can generate files for the resource we want to create:

- a controller
- a service
- a module

```bash
nest generate controller users
```

```bash
nest generate service users
```

```bash
nest generate module users
```

In the `src/users` folder and let's create a user.module.ts file. From the command line, you can type:

```
touch src/users/user.model.ts
```

The project structure looks like this:

![image.png](https://cdn.hashnode.com/res/hashnode/image/upload/v1611136117342/0Eb9sEdO_.png)

---

### Model

In the users.model.ts, we can create a model for the resource we want to use.
We will use a 'user' resource, with name, surname, and points, of the type string, string, and number respectively. Please note that here we are not using Typescript types, but plain JavaScript ones.

We don't need to add the "id" primary key in the schema, because it will be generated by Mongoose

```typescript
import * as mongoose from 'mongoose';

export const UserSchema = new mongoose.Schema({
  fullName: { type: String, required: true },
  userName: { type: String, required: true },
  email: { type: String, required: true },
  rooms: [{ type: mongoose.Schema.Types.ObjectId, ref: 'Room' }],
});

export class User {
  id: string;
  fullName: string;
  userName: string;
  email: string;
}
```

### Service

We will use a Nest Service, which will be called by the controller functions.

Using the Mongoose library, we can easily work with objects in the Mongo Database

We can also import "NotFoundException" to have better error Handling in our application.

users.service.ts

```typescript
import { Injectable } from '@nestjs/common';
import { InjectModel } from '@nestjs/mongoose';
import { Model } from 'mongoose';
import { User } from './user.model';

@Injectable()
export class UsersService {
  constructor(@InjectModel('User') private readonly userModel: Model<User>) {}

  /**
   * Create a new user
   * @param  fullName
   * @param  userName
   * @param  email
   * @param  phoneNumber
   * @param  bio
   * @param password
   */
  async createUser(
    fullName: string,
    userName: string,
    email: string,
    phoneNumber: string,
    bio: string,
    hashedPassword: string,
  ) {
    const newUser = new this.userModel({
      fullName,
      userName,
      email,
      phoneNumber,
      bio,
      password: hashedPassword,
    });
    const response = await newUser.save({ validateBeforeSave: true });
    return response;
  }

  /**
   * Find all users
   */
  async getAllUsers() {
    const users = await this.userModel.find().sort('-createdAt');
    if (users.length < 1) {
      throw new NotFoundException('No users found in database');
    }
    return users;
  }
}
```

---

## EndPoints

```bash
# Create a Room
POST /api/rooms/create_room

# Add User to a Room
PUT /api/rooms/:roomId/add_user

# Send Message to a Room
POST /api/messages/:userId/rooms/:roomId

# Get Latest Messages from a Room

GET /api/messages/room/get_messages

```

## Examples

```
{
    path: /api/rooms/create_room,
    method: POST,
    body: {
        roomName: Colkie Engineers,
        description: Your passion, your community
    }
}
{
    path: /api/rooms/:roomId/add_user
    method: PUT,
    params: {
        path: roomId(e.g "654737tyehhdj89")
        query: userId(e.g "564yhjdj722822")
    }

    The full path becomes - /api/rooms/654737tyehhdj89/add_user?userId=564yhjdj722822
}
{
    path: /api/messages/:userId/rooms/:roomId,
    method: POST,
    params: {
      userId: 564yhjdj722822
      roomId: 654737tyehhdj89
    }
    body: {
        body: Hello, how are you today?,
    }
}
{
    path: /api/messages/room/get_messages,
    method: GET,
    params: {
      query: roomId(e.g "654737tyehhdj89")
    }

    The full path becomes - /api/messages/room/get_messages?roomId=654737tyehhdj89
}
```

## Author

**©️ Brian Etaghene**
